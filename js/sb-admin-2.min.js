/*!
 * Start Bootstrap - SB Admin 2 v4.1.3 (https://startbootstrap.com/theme/sb-admin-2)
 * Copyright 2013-2020 Start Bootstrap
 * Licensed under MIT (https://github.com/StartBootstrap/startbootstrap-sb-admin-2/blob/master/LICENSE)
 */

function formatDate(e){var t=e.getDate(),o=e.getMonth()+1;return t<10&&(t="0"+t),o<10&&(o="0"+o),e=o+"/"+t+"/"+e.getFullYear()}function formateDatev2(e){return(8<(e=new Date(e)).getMonth()?e.getMonth()+1:"0"+(e.getMonth()+1))+"/"+(9<e.getDate()?e.getDate():"0"+e.getDate())+"/"+e.getFullYear()}function Last1Days(){for(var e=[],t=1;0<t;t--){var o=new Date;o.setDate(o.getDate()-t),e.push(formatDate(o))}return e}function Last7Days(){for(var e=[],t=1;0<t;t--){var o=new Date;o.setDate(o.getDate()-t),e.push(formatDate(o))}return e}function groupBy(e,a){return e.reduce(function(e,t){var o=t[a];return e[o]||(e[o]=[]),e[o].push(t),e},{})}function updateData(e){for(var t=0;t<e.length;t++){var o=e[t].time.split(":")[0];e[t].time=o}return e}function updateData2(e,t){for(var o=0;o<e.length;o++){var a=new Date(t);new Date(formateDatev2(e[o].time))<a&&e.splice(o,1)}return e}function getData(){var e=localStorage.getItem("user");$.ajax({type:"GET",url:"http://localhost:8080/nutritionOrder/"+e,async:!0,success:function(e){var t=groupBy(updateData2(updateData(e),Last1Days()[0]),"time"),o=0;for(var a in t)for(var n=0;n<t[a].length;n++)o+=Number(t[a][n].calories);$("#TotalCalorieCount").text(o)},error:function(e,t,o){console.log("Error: "+e.responseText)}})}function getData2(){var e=localStorage.getItem("user"),s=[];return $.ajax({type:"GET",url:"http://localhost:8080/nutritionOrder/"+e,async:!0,success:function(e){var t=groupBy(updateData2(updateData(e),Last7Days()[0]),"time"),o=0;for(var a in t){for(var n=0,r=0;r<t[a].length;r++)n+=Number(t[a][r].calories);s[o]=n,o++}var l=Math.max.apply(Math,s.map(function(e){return e}));2e3<Number(l)?$("#foodIntakeStatus").text("Food intake is high, please control the diet!!"):$("#foodIntakeStatus").text("Food intake is normal,good job!!")},error:function(e,t,o){console.log("Error: "+e.responseText)}}),s}function getData3(){var e=localStorage.getItem("user"),l=[];$.ajax({type:"GET",url:"http://localhost:8080/observation/"+e,async:!0,success:function(e){var t=groupBy(updateData2(updateData(e),Last7Days()[0]),"time"),o=0;for(var a in t){var n=Math.max.apply(Math,t[a].map(function(e){return e.diabeticRecord}));l[o]=n,o++}var r=Math.max.apply(Math,l.map(function(e){return e}));200<Number(r)?$("#diabeticRecordStatus").text("Diabetic record is high!!"):$("#diabeticRecordStatus").text("Diabetic record is normal,good job!!")},error:function(e,t,o){console.log("Error: "+e.responseText)}})}function getTime(e){var t,o,a=document.getElementById(e).value.split(":");return 12<(t=a[0])?(o="PM",t-=12):t<12?(o="AM",0==t&&(t=12)):o="PM",t+":"+a[1]+" "+o}!function(s){"use strict";s("#sidebarToggle, #sidebarToggleTop").on("click",function(e){s("body").toggleClass("sidebar-toggled"),s(".sidebar").toggleClass("toggled"),s(".sidebar").hasClass("toggled")&&s(".sidebar .collapse").collapse("hide")}),s(window).resize(function(){s(window).width()<768&&s(".sidebar .collapse").collapse("hide"),s(window).width()<480&&!s(".sidebar").hasClass("toggled")&&(s("body").addClass("sidebar-toggled"),s(".sidebar").addClass("toggled"),s(".sidebar .collapse").collapse("hide"))}),s("body.fixed-nav .sidebar").on("mousewheel DOMMouseScroll wheel",function(e){if(768<s(window).width()){var t=e.originalEvent,o=t.wheelDelta||-t.detail;this.scrollTop+=30*(o<0?1:-1),e.preventDefault()}}),s(document).on("scroll",function(){100<s(this).scrollTop()?s(".scroll-to-top").fadeIn():s(".scroll-to-top").fadeOut()}),s(document).on("click","a.scroll-to-top",function(e){var t=s(this);s("html, body").stop().animate({scrollTop:s(t.attr("href")).offset().top},1e3,"easeInOutExpo"),e.preventDefault()}),s("#closeBloodSugarReading").click(function(){s("form#addReading").trigger("reset"),s("#successMessage").toggleClass("d-none")}),s("#closePastMealsModal").click(function(){s("#pastMealsModal").trigger("reset"),s("#pastMealsModal").modal("hide")}),s("#closeGetMedications").click(function(){s("#getMedications").trigger("reset"),s("#getMedications").modal("hide")}),s("#closePastObservationsModal").click(function(){s("#pastObservationsModal").trigger("reset"),s("#pastObservationsModal").modal("hide")}),s("#closeMeal").click(function(){s("form#addMeal").trigger("reset"),s("#successMealMessage").toggleClass("d-none")}),s("#closeMedicationSearch").click(function(){s("form#addMedical").trigger("reset"),s("#successMealMessage").toggleClass("d-none")}),s("form#loginForm").submit(function(){var e=s("#username").val(),t=s("#password").val();return s.ajax({type:"POST",url:"http://localhost:8080/login",data:JSON.stringify({username:e,password:t}),contentType:"application/json",success:function(e,t,o){console.log(e),localStorage.setItem("user",e.patientId),localStorage.setItem("username",e.username),window.location="index.html"},error:function(e,t,o){console.log("error"),s("#errorMessage").removeClass("d-none")}}),!1}),s("form#signup").submit(function(){var e=s("#username").val(),t=s("#password").val(),o=s("#firstName").val()+" "+s("#lastName").val(),a=s("#gender").val(),n=s("#age").val();return s.ajax({type:"POST",url:"http://localhost:8080/signup",data:JSON.stringify({username:e,password:t,name:o,gender:a,age:n,email:"testemail123@gmail.com",phone:"2012203000",dob:"1993-10-25"}),contentType:"application/json",success:function(e,t,o){console.log(e),localStorage.setItem("user",e.patientId),localStorage.setItem("username",e.username),window.location="index.html"},error:function(e,t,o){console.log("error"),s("#errorMessage").removeClass("d-none")}}),!1}),s("form#addReading").submit(function(){var e=s("#reading").val(),t=getTime("time"),o=localStorage.getItem("user"),a=null===s("#description1").val()?s("#description2").val():s("#description1").val();return s.ajax({type:"POST",url:"http://localhost:8080/observation",data:JSON.stringify({patientId:o,description:a,reading:e,time:t}),contentType:"application/json",success:function(e,t,o){console.log(e),s("#successMessage").toggleClass("d-none")},error:function(e,t,o){console.log("error")}}),!1}),s("form#addMeal").submit(function(){var e=s("#mealName").val(),t=getTime("mealTime"),o=localStorage.getItem("user"),a=s("#mealPortion").val(),n=s("#foodInfo").val();return s.ajax({type:"POST",url:"http://localhost:8080/nutritionOrder",data:JSON.stringify({patientId:o,name:e,dosage:a,unit:n,time:t}),contentType:"application/json",success:function(e,t,o){console.log(e),s("#successMealMessage").toggleClass("d-none")},error:function(e,t,o){console.log("error")}}),!1}),s("form#addMedical").submit(function(){var e=s("#medicineName").val(),t=getTime("medicationTime"),o=localStorage.getItem("user"),a=s("#medicationDosage").val(),n=s("#medicationUnit").val();return s.ajax({type:"POST",url:"http://localhost:8080/medication",data:JSON.stringify({patientId:o,name:e,dosage:a,unit:n,time:t}),contentType:"application/json",success:function(e,t,o){console.log(e),s("#successMedicationMessage").toggleClass("d-none")},error:function(e,t,o){console.log("error")}}),!1}),s("#pastMedications").click(function(){var e=localStorage.getItem("user");s.ajax({type:"GET",url:"http://localhost:8080/medication/"+e,success:function(e){var o='<table class="table">';o+="<th>No</th>",o+="<th>Time Recorded</th>",o+="<th>Medication Name</th>",o+="<th>Dosage/Quantity</th>",o+="<th>Unit</th>",s(e).each(function(e,t){o+="<tr>",o+="<td>"+e+"</td>",o+="<td>"+t.time+"</td>",o+="<td>"+t.medicationName+"</td>",o+="<td>"+t.dosage.split(" ")[0]+"</td>",o+="<td>"+t.dosage.split(" ")[1]+"</td>",o+="</tr>"}),o+="</table>",s("#getMedicationsTable").html(o)},error:function(e,t,o){console.log("Error: "+e.responseText)}})}),s("#pastObservations").click(function(){var e=localStorage.getItem("user");s.ajax({type:"GET",url:"http://localhost:8080/observation/"+e,success:function(e){var o='<table class="table">';o+="<th>No</th>",o+="<th>Time Recorded</th>",o+="<th>Diabetic Value</th>",s(e).each(function(e,t){o+="<tr>",o+="<td>"+e+"</td>",o+="<td>"+t.time+"</td>",o+="<td>"+t.diabeticRecord+" mg/dL</td>",o+="</tr>"}),o+="</table>",s("#pastObservationsTable").html(o)},error:function(e,t,o){console.log("Error: "+e.responseText)}})}),s("#pastMeals").click(function(){var e=localStorage.getItem("user");s.ajax({type:"GET",url:"http://localhost:8080/nutritionOrder/"+e,success:function(e){var o='<table class="table">';o+="<th>No</th>",o+="<th>Time Recorded</th>",o+="<th>Food Name</th>",o+="<th>Meal Size</th>",o+="<th>Calories</th>",s(e).each(function(e,t){o+="<tr>",o+="<td>"+e+"</td>",o+="<td>"+t.time+"</td>",o+="<td>"+t.foodName+"</td>",o+="<td>"+t.mealSize+"</td>",o+="<td>"+t.calories+"</td>",o+="</tr>"}),o+="</table>",s("#pastMealsTable").html(o)},error:function(e,t,o){console.log("Error: "+e.responseText)}})}),s("#searchFoodButton").click(function(){var e=s("#mealName").val(),t=null;s.ajax({type:"GET",url:"http://localhost:8080/food/find?foodName="+e,success:function(e){t=e.branded,s("#searchFood").modal("toggle");var o='<table class="table">';o+="<th>No</th>",o+="<th>Food name</th>",o+="<th>Calories</th>",o+="<th>Serving quantity</th>",o+="<th>Select</th>",s(t).each(function(e,t){o+="<tr>",o+="<td>"+e+"</td>",o+="<td>"+t.food_name+"</td>",o+="<td>"+t.nf_calories+"</td>",o+="<td>"+t.serving_qty+"</td>",o+="<td><button id='selectFoodButton'  type='button' class='btn btn-primary'>Select</button></td>",o+="</tr>"}),o+="</table>",s("#searchFoodTable").html(o)},error:function(e,t,o){console.log("Error: "+e.responseText)}})}),s("#searchMedicineButton").click(function(){var e=s("#medicineName").val(),t=null;s.ajax({type:"GET",url:"http://localhost:8080/medication/find?medicationName="+e,success:function(e){t=e,s("#searchMedicine").modal("toggle");var a='<table class="table">';a+="<th>No</th>",a+="<th>Medicine name</th>",a+="<th>Type</th>",a+="<th>Select</th>",s(t).each(function(e,t){var o=unescape(t).split(",");a+="<tr>",a+="<td>"+e+"</td>",a+="<td>"+o[2].replaceAll('"',"")+"</td>",a+="<td>"+o[3].replaceAll('"',"")+"</td>",a+="<td><button id='selectMedicineButton'  type='button' class='btn btn-primary'>Select</button></td>",a+="</tr>"}),a+="</table>",s("#searchMedicineTable").html(a)},error:function(e,t,o){console.log("Error: "+e.responseText)}})}),s("#searchFood #searchFoodTable").on("click","#selectFoodButton",function(){var e=s(this).closest("tr").find("td"),t="";s.each(e,function(){console.log(s(this).text()),t+=s(this).text()+":"}),s("#searchFood").modal("hide"),s("#foodInfo").val(t),s("#mealName").val(t.split(":")[1])}),s("#closeSearch").click(function(){s("#searchFood").modal("hide")}),s("#logoutProcess").click(function(){localStorage.removeItem("user"),window.location="login.html"}),s("#searchMedicine #searchMedicineTable").on("click","#selectMedicineButton",function(){var e=s(this).closest("tr").find("td"),t="";s.each(e,function(){t+=s(this).text()+":"}),s("#searchMedicine").modal("hide"),s("#medicalInfo").val(t);for(var o=t.split(":"),a=o[1].split(" "),n=null,r=0;r<a.length;r++)(a[r].includes("MG")||a[r].includes("MG\\ML")||a[r].includes("ML"))&&(n=a[r]);if(null!==n)s("#medicineName").val(o[1].replaceAll(n,"")),s("#medicationUnit").val(n);else{s("#medicineName").val(o[1]);var l=s("#medicationUnit").val();console.log(l),s("#medicationUnit").val("")}}),s("#closeMedicationSearch").click(function(){s("#searchMedicine").modal("hide")})}(jQuery);