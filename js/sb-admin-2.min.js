/*!
 * Start Bootstrap - SB Admin 2 v4.1.3 (https://startbootstrap.com/theme/sb-admin-2)
 * Copyright 2013-2020 Start Bootstrap
 * Licensed under MIT (https://github.com/StartBootstrap/startbootstrap-sb-admin-2/blob/master/LICENSE)
 */

function formatDate(e){var t=e.getDate(),a=e.getMonth()+1;return t<10&&(t="0"+t),a<10&&(a="0"+a),e=a+"/"+t+"/"+e.getFullYear()}function formateDatev2(e){return(8<(e=new Date(e)).getMonth()?e.getMonth()+1:"0"+(e.getMonth()+1))+"/"+(9<e.getDate()?e.getDate():"0"+e.getDate())+"/"+e.getFullYear()}function Last1Days(){for(var e=[],t=1;0<t;t--){var a=new Date;a.setDate(a.getDate()-t),e.push(formatDate(a))}return e}function Last7Days(){for(var e=[],t=1;0<t;t--){var a=new Date;a.setDate(a.getDate()-t),e.push(formatDate(a))}return e}function groupBy(e,o){return e.reduce(function(e,t){var a=t[o];return e[a]||(e[a]=[]),e[a].push(t),e},{})}function updateData(e){for(var t=0;t<e.length;t++){var a=e[t].time.split(":")[0];e[t].time=a}return e}function updateData2(e,t){for(var a=0;a<e.length;a++){var o=new Date(t);new Date(formateDatev2(e[a].time))<o&&e.splice(a,1)}return e}function getData(){var e=localStorage.getItem("user");$.ajax({type:"GET",url:"https://diabetes-tracker-backend.herokuapp.com/nutritionOrder/"+e,async:!0,success:function(e){var t=groupBy(updateData2(updateData(e),Last1Days()[0]),"time"),a=0;for(var o in t)for(var r=0;r<t[o].length;r++)a+=Number(t[o][r].calories);$("#TotalCalorieCount").text(a)},error:function(e,t,a){console.log("Error: "+e.responseText)}})}function getData2(){var e=localStorage.getItem("user"),i=[];return $.ajax({type:"GET",url:"https://diabetes-tracker-backend.herokuapp.com/nutritionOrder/"+e,async:!0,success:function(e){var t=groupBy(updateData2(updateData(e),Last7Days()[0]),"time"),a=0;for(var o in t){for(var r=0,n=0;n<t[o].length;n++)r+=Number(t[o][n].calories);i[a]=r,a++}var s=Math.max.apply(Math,i.map(function(e){return e}));2e3<Number(s)?$("#foodIntakeStatus").text("Food intake is high, please control the diet!!"):$("#foodIntakeStatus").text("Food intake is normal,good job!!")},error:function(e,t,a){console.log("Error: "+e.responseText)}}),i}function getData3(){var e=localStorage.getItem("user"),c=[];$.ajax({type:"GET",url:"https://diabetes-tracker-backend.herokuapp.com/observation/"+e,async:!0,success:function(e){var t=groupBy(updateData2(updateData(e),Last7Days()[0]),"time"),a=0;for(var o in t){var r=Math.max.apply(Math,t[o].map(function(e){return e.diabeticRecord}));c[a]=r,a++}var n=Math.max.apply(Math,c.map(function(e){return e}));if(200<Number(n)?$("#diabeticRecordStatus").text("Diabetic record is high!!"):$("#diabeticRecordStatus").text("Diabetic record is normal,good job!!"),c.length<=7)for(var s=7-c.length,i=0;i<s;i++)c.unshift(0);console.log(c[6]),c[6]==Number(0)&&addAlert("Please take your medications and enter the blood sugar reading")},error:function(e,t,a){console.log("Error: "+e.responseText)}})}function addAlert(e){$("#alertss").append('<div class="alert alert-success alert-dismissible"><button type="button" class="close" data-dismiss="alert">&times;</button>'+e+"</div>")}function getTime(e){var t,a,o=document.getElementById(e).value.split(":");return 12<(t=o[0])?(a="PM",t-=12):t<12?(a="AM",0==t&&(t=12)):a="PM",t+":"+o[1]+" "+a}!function(i){"use strict";i("#sidebarToggle, #sidebarToggleTop").on("click",function(e){i("body").toggleClass("sidebar-toggled"),i(".sidebar").toggleClass("toggled"),i(".sidebar").hasClass("toggled")&&i(".sidebar .collapse").collapse("hide")}),i(window).resize(function(){i(window).width()<768&&i(".sidebar .collapse").collapse("hide"),i(window).width()<480&&!i(".sidebar").hasClass("toggled")&&(i("body").addClass("sidebar-toggled"),i(".sidebar").addClass("toggled"),i(".sidebar .collapse").collapse("hide"))}),i("body.fixed-nav .sidebar").on("mousewheel DOMMouseScroll wheel",function(e){if(768<i(window).width()){var t=e.originalEvent,a=t.wheelDelta||-t.detail;this.scrollTop+=30*(a<0?1:-1),e.preventDefault()}}),i(document).on("scroll",function(){100<i(this).scrollTop()?i(".scroll-to-top").fadeIn():i(".scroll-to-top").fadeOut()}),i(document).on("click","a.scroll-to-top",function(e){var t=i(this);i("html, body").stop().animate({scrollTop:i(t.attr("href")).offset().top},1e3,"easeInOutExpo"),e.preventDefault()}),i("#closeBloodSugarReading").click(function(){i("form#addReading").trigger("reset"),i("#successMessage").toggleClass("d-none")}),i("#closePastMealsModal").click(function(){i("#pastMealsModal").trigger("reset"),i("#pastMealsModal").modal("hide")}),i("#closeGetMedications").click(function(){i("#getMedications").trigger("reset"),i("#getMedications").modal("hide")}),i("#closePastObservationsModal").click(function(){i("#pastObservationsModal").trigger("reset"),i("#pastObservationsModal").modal("hide")}),i("#closeMeal").click(function(){i("form#addMeal").trigger("reset"),i("#successMealMessage").toggleClass("d-none")}),i("#closeMedicationSearch").click(function(){i("form#addMedical").trigger("reset"),i("#successMealMessage").toggleClass("d-none")}),i("form#loginForm").submit(function(){var e=i("#username").val(),t=i("#password").val();return i.ajax({type:"POST",url:"https://diabetes-tracker-backend.herokuapp.com/login",data:JSON.stringify({username:e,password:t}),contentType:"application/json",success:function(e,t,a){console.log(e),localStorage.setItem("user",e.patientId),localStorage.setItem("username",e.username),window.location="index.html"},error:function(e,t,a){console.log("error"),i("#errorMessage").removeClass("d-none")}}),!1}),i("form#signup").submit(function(){var e=i("#username").val(),t=i("#password").val(),a=i("#firstName").val()+" "+i("#lastName").val(),o=i("#gender").val(),r=i("#age").val();return i.ajax({type:"POST",url:"https://diabetes-tracker-backend.herokuapp.com/signup",data:JSON.stringify({username:e,password:t,name:a,gender:o,age:r,email:"testemail123@gmail.com",phone:"2012203000",dob:"1993-10-25"}),contentType:"application/json",success:function(e,t,a){console.log(e),localStorage.setItem("user",e.patientId),localStorage.setItem("username",e.username),window.location="index.html"},error:function(e,t,a){console.log("error"),i("#errorMessage").removeClass("d-none")}}),!1}),i("form#addReading").submit(function(){var e=i("#reading").val(),t=getTime("time"),a=localStorage.getItem("user"),o=null===i("#description1").val()?i("#description2").val():i("#description1").val();return i.ajax({type:"POST",url:"https://diabetes-tracker-backend.herokuapp.com/observation",data:JSON.stringify({patientId:a,description:o,reading:e,time:t}),contentType:"application/json",success:function(e,t,a){console.log(e),i("#successMessage").toggleClass("d-none")},error:function(e,t,a){console.log("error")}}),!1}),i("form#addMeal").submit(function(){var e=i("#mealName").val(),t=getTime("mealTime"),a=localStorage.getItem("user"),o=i("#mealPortion").val(),r=i("#foodInfo").val();return i.ajax({type:"POST",url:"https://diabetes-tracker-backend.herokuapp.com/nutritionOrder",data:JSON.stringify({patientId:a,name:e,dosage:o,unit:r,time:t}),contentType:"application/json",success:function(e,t,a){console.log(e),i("#successMealMessage").toggleClass("d-none")},error:function(e,t,a){console.log("error")}}),!1}),i("form#addMedical").submit(function(){var e=i("#medicineName").val(),t=getTime("medicationTime"),a=localStorage.getItem("user"),o=i("#medicationDosage").val(),r=i("#medicationUnit").val();return i.ajax({type:"POST",url:"https://diabetes-tracker-backend.herokuapp.com/medication",data:JSON.stringify({patientId:a,name:e,dosage:o,unit:r,time:t}),contentType:"application/json",success:function(e,t,a){console.log(e),i("#successMedicationMessage").toggleClass("d-none")},error:function(e,t,a){console.log("error")}}),!1}),i("#pastMedications").click(function(){var e=localStorage.getItem("user");i.ajax({type:"GET",url:"https://diabetes-tracker-backend.herokuapp.com/medication/"+e,success:function(e){var a='<table class="table">';a+="<th>No</th>",a+="<th>Time Recorded</th>",a+="<th>Medication Name</th>",a+="<th>Dosage/Quantity</th>",a+="<th>Unit</th>",i(e).each(function(e,t){a+="<tr>",a+="<td>"+e+"</td>",a+="<td>"+t.time+"</td>",a+="<td>"+t.medicationName+"</td>",a+="<td>"+t.dosage.split(" ")[0]+"</td>",a+="<td>"+t.dosage.split(" ")[1]+"</td>",a+="</tr>"}),a+="</table>",i("#getMedicationsTable").html(a)},error:function(e,t,a){console.log("Error: "+e.responseText)}})}),i("#pastObservations").click(function(){var e=localStorage.getItem("user");i.ajax({type:"GET",url:"https://diabetes-tracker-backend.herokuapp.com/observation/"+e,success:function(e){var a='<table class="table">';a+="<th>No</th>",a+="<th>Time Recorded</th>",a+="<th>Diabetic Value</th>",i(e).each(function(e,t){a+="<tr>",a+="<td>"+e+"</td>",a+="<td>"+t.time+"</td>",a+="<td>"+t.diabeticRecord+" mg/dL</td>",a+="</tr>"}),a+="</table>",i("#pastObservationsTable").html(a)},error:function(e,t,a){console.log("Error: "+e.responseText)}})}),i("#pastMeals").click(function(){var e=localStorage.getItem("user");i.ajax({type:"GET",url:"https://diabetes-tracker-backend.herokuapp.com/nutritionOrder/"+e,success:function(e){var a='<table class="table">';a+="<th>No</th>",a+="<th>Time Recorded</th>",a+="<th>Food Name</th>",a+="<th>Meal Size</th>",a+="<th>Calories</th>",i(e).each(function(e,t){a+="<tr>",a+="<td>"+e+"</td>",a+="<td>"+t.time+"</td>",a+="<td>"+t.foodName+"</td>",a+="<td>"+t.mealSize+"</td>",a+="<td>"+t.calories+"</td>",a+="</tr>"}),a+="</table>",i("#pastMealsTable").html(a)},error:function(e,t,a){console.log("Error: "+e.responseText)}})}),i("#searchFoodButton").click(function(){var e=i("#mealName").val(),t=null;i.ajax({type:"GET",url:"https://diabetes-tracker-backend.herokuapp.com/food/find?foodName="+e,success:function(e){t=e.branded,i("#searchFood").modal("toggle");var a='<table class="table">';a+="<th>No</th>",a+="<th>Food name</th>",a+="<th>Calories</th>",a+="<th>Serving quantity</th>",a+="<th>Select</th>",i(t).each(function(e,t){a+="<tr>",a+="<td>"+e+"</td>",a+="<td>"+t.food_name+"</td>",a+="<td>"+t.nf_calories+"</td>",a+="<td>"+t.serving_qty+"</td>",a+="<td><button id='selectFoodButton'  type='button' class='btn btn-primary'>Select</button></td>",a+="</tr>"}),a+="</table>",i("#searchFoodTable").html(a)},error:function(e,t,a){console.log("Error: "+e.responseText)}})}),i("#searchMedicineButton").click(function(){var e=i("#medicineName").val(),t=null;i.ajax({type:"GET",url:"https://diabetes-tracker-backend.herokuapp.com/medication/find?medicationName="+e,success:function(e){t=e,i("#searchMedicine").modal("toggle");var o='<table class="table">';o+="<th>No</th>",o+="<th>Medicine name</th>",o+="<th>Type</th>",o+="<th>Select</th>",i(t).each(function(e,t){var a=unescape(t).split(",");o+="<tr>",o+="<td>"+e+"</td>",o+="<td>"+a[2].replaceAll('"',"")+"</td>",o+="<td>"+a[3].replaceAll('"',"")+"</td>",o+="<td><button id='selectMedicineButton'  type='button' class='btn btn-primary'>Select</button></td>",o+="</tr>"}),o+="</table>",i("#searchMedicineTable").html(o)},error:function(e,t,a){console.log("Error: "+e.responseText)}})}),i("#searchFood #searchFoodTable").on("click","#selectFoodButton",function(){var e=i(this).closest("tr").find("td"),t="";i.each(e,function(){console.log(i(this).text()),t+=i(this).text()+":"}),i("#searchFood").modal("hide"),i("#foodInfo").val(t),i("#mealName").val(t.split(":")[1])}),i("#closeSearch").click(function(){i("#searchFood").modal("hide")}),i("#logoutProcess").click(function(){localStorage.removeItem("user"),localStorage.removeItem("username"),window.location="login.html"}),i("#searchMedicine #searchMedicineTable").on("click","#selectMedicineButton",function(){var e=i(this).closest("tr").find("td"),t="";i.each(e,function(){t+=i(this).text()+":"}),i("#searchMedicine").modal("hide"),i("#medicalInfo").val(t);for(var a=t.split(":"),o=a[1].split(" "),r=null,n=0;n<o.length;n++)(o[n].includes("MG")||o[n].includes("MG\\ML")||o[n].includes("ML"))&&(r=o[n]);if(null!==r)i("#medicineName").val(a[1].replaceAll(r,"")),i("#medicationUnit").val(r);else{i("#medicineName").val(a[1]);var s=i("#medicationUnit").val();console.log(s),i("#medicationUnit").val("")}}),i("#closeMedicationSearch").click(function(){i("#searchMedicine").modal("hide")})}(jQuery);