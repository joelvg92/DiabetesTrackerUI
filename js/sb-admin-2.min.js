/*!
 * Start Bootstrap - SB Admin 2 v4.1.3 (https://startbootstrap.com/theme/sb-admin-2)
 * Copyright 2013-2020 Start Bootstrap
 * Licensed under MIT (https://github.com/StartBootstrap/startbootstrap-sb-admin-2/blob/master/LICENSE)
 */

function formatDate(t){var e=t.getDate(),o=t.getMonth()+1;return e<10&&(e="0"+e),o<10&&(o="0"+o),t=o+"/"+e+"/"+t.getFullYear()}function formateDatev2(t){return(8<(t=new Date(t)).getMonth()?t.getMonth()+1:"0"+(t.getMonth()+1))+"/"+(9<t.getDate()?t.getDate():"0"+t.getDate())+"/"+t.getFullYear()}function Last1Days(){for(var t=[],e=1;0<e;e--){var o=new Date;o.setDate(o.getDate()-e),t.push(formatDate(o))}return t}function Last7Days(){for(var t=[],e=1;0<e;e--){var o=new Date;o.setDate(o.getDate()-e),t.push(formatDate(o))}return t}function groupBy(t,a){return t.reduce(function(t,e){var o=e[a];return t[o]||(t[o]=[]),t[o].push(e),t},{})}function updateData(t){for(var e=0;e<t.length;e++){var o=t[e].time.split(":")[0];t[e].time=o}return t}function updateData2(t,e){for(var o=0;o<t.length;o++){var a=new Date(e);new Date(formateDatev2(t[o].time))<a&&t.splice(o,1)}return t}function getData(){var t=localStorage.getItem("user");$.ajax({type:"GET",url:"http://localhost:8080/nutritionOrder/"+t,async:!0,success:function(t){var e=groupBy(updateData2(updateData(t),Last1Days()[0]),"time"),o=0;for(var a in e)for(var n=0;n<e[a].length;n++)o+=Number(e[a][n].calories);$("#TotalCalorieCount").text(o)},error:function(t,e,o){console.log("Error: "+t.responseText)}})}function getData2(){var t=localStorage.getItem("user"),i=[];return $.ajax({type:"GET",url:"http://localhost:8080/nutritionOrder/"+t,async:!0,success:function(t){var e=groupBy(updateData2(updateData(t),Last7Days()[0]),"time"),o=0;for(var a in e){for(var n=0,r=0;r<e[a].length;r++)n+=Number(e[a][r].calories);i[o]=n,o++}var l=Math.max.apply(Math,i.map(function(t){return t}));2e3<Number(l)?$("#foodIntakeStatus").text("Food intake is high, please control the diet!!"):$("#foodIntakeStatus").text("Food intake is normal,good job!!")},error:function(t,e,o){console.log("Error: "+t.responseText)}}),i}function getData3(){var t=localStorage.getItem("user"),l=[];$.ajax({type:"GET",url:"http://localhost:8080/observation/"+t,async:!0,success:function(t){var e=groupBy(updateData2(updateData(t),Last7Days()[0]),"time"),o=0;for(var a in e){var n=Math.max.apply(Math,e[a].map(function(t){return t.diabeticRecord}));l[o]=n,o++}var r=Math.max.apply(Math,l.map(function(t){return t}));200<Number(r)?$("#diabeticRecordStatus").text("Diabetic record is high!!"):$("#diabeticRecordStatus").text("Diabetic record is normal,good job!!")},error:function(t,e,o){console.log("Error: "+t.responseText)}})}function getTime(t){var e,o,a=document.getElementById(t).value.split(":");return 12<(e=a[0])?(o="PM",e-=12):e<12?(o="AM",0==e&&(e=12)):o="PM",e+":"+a[1]+" "+o}!function(i){"use strict";i("#sidebarToggle, #sidebarToggleTop").on("click",function(t){i("body").toggleClass("sidebar-toggled"),i(".sidebar").toggleClass("toggled"),i(".sidebar").hasClass("toggled")&&i(".sidebar .collapse").collapse("hide")}),i(window).resize(function(){i(window).width()<768&&i(".sidebar .collapse").collapse("hide"),i(window).width()<480&&!i(".sidebar").hasClass("toggled")&&(i("body").addClass("sidebar-toggled"),i(".sidebar").addClass("toggled"),i(".sidebar .collapse").collapse("hide"))}),i("body.fixed-nav .sidebar").on("mousewheel DOMMouseScroll wheel",function(t){if(768<i(window).width()){var e=t.originalEvent,o=e.wheelDelta||-e.detail;this.scrollTop+=30*(o<0?1:-1),t.preventDefault()}}),i(document).on("scroll",function(){100<i(this).scrollTop()?i(".scroll-to-top").fadeIn():i(".scroll-to-top").fadeOut()}),i(document).on("click","a.scroll-to-top",function(t){var e=i(this);i("html, body").stop().animate({scrollTop:i(e.attr("href")).offset().top},1e3,"easeInOutExpo"),t.preventDefault()}),i("#closeBloodSugarReading").click(function(){i("form#addReading").trigger("reset"),i("#successMessage").toggleClass("d-none")}),i("#closePastMealsModal").click(function(){i("#pastMealsModal").trigger("reset"),i("#pastMealsModal").modal("hide")}),i("#closeGetMedications").click(function(){i("#getMedications").trigger("reset"),i("#getMedications").modal("hide")}),i("#closePastObservationsModal").click(function(){i("#pastObservationsModal").trigger("reset"),i("#pastObservationsModal").modal("hide")}),i("#closeMeal").click(function(){i("form#addMeal").trigger("reset"),i("#successMealMessage").toggleClass("d-none")}),i("#closeMedicationSearch").click(function(){i("form#addMedical").trigger("reset"),i("#successMealMessage").toggleClass("d-none")}),i("form#loginForm").submit(function(){var t=i("#username").val(),e=i("#password").val();return i.ajax({type:"POST",url:"http://localhost:8080/login",data:JSON.stringify({username:t,password:e}),contentType:"application/json",success:function(t,e,o){console.log(t),localStorage.setItem("user",t.patientId),localStorage.setItem("username",t.username),window.location="index.html"},error:function(t,e,o){console.log("error"),i("#errorMessage").removeClass("d-none")}}),!1}),i("form#addReading").submit(function(){var t=i("#reading").val(),e=getTime("time"),o=localStorage.getItem("user"),a=null===i("#description1").val()?i("#description2").val():i("#description1").val();return i.ajax({type:"POST",url:"http://localhost:8080/observation",data:JSON.stringify({patientId:o,description:a,reading:t,time:e}),contentType:"application/json",success:function(t,e,o){console.log(t),i("#successMessage").toggleClass("d-none")},error:function(t,e,o){console.log("error")}}),!1}),i("form#addMeal").submit(function(){var t=i("#mealName").val(),e=getTime("mealTime"),o=localStorage.getItem("user"),a=i("#mealPortion").val(),n=i("#foodInfo").val();return i.ajax({type:"POST",url:"http://localhost:8080/nutritionOrder",data:JSON.stringify({patientId:o,name:t,dosage:a,unit:n,time:e}),contentType:"application/json",success:function(t,e,o){console.log(t),i("#successMealMessage").toggleClass("d-none")},error:function(t,e,o){console.log("error")}}),!1}),i("form#addMedical").submit(function(){var t=i("#medicineName").val(),e=getTime("medicationTime"),o=localStorage.getItem("user"),a=i("#medicationDosage").val(),n=i("#medicationUnit").val();return i.ajax({type:"POST",url:"http://localhost:8080/medication",data:JSON.stringify({patientId:o,name:t,dosage:a,unit:n,time:e}),contentType:"application/json",success:function(t,e,o){console.log(t),i("#successMedicationMessage").toggleClass("d-none")},error:function(t,e,o){console.log("error")}}),!1}),i("#pastMedications").click(function(){var t=localStorage.getItem("user");i.ajax({type:"GET",url:"http://localhost:8080/medication/"+t,success:function(t){var o='<table class="table">';o+="<th>No</th>",o+="<th>Time Recorded</th>",o+="<th>Medication Name</th>",o+="<th>Dosage/Quantity</th>",o+="<th>Unit</th>",i(t).each(function(t,e){o+="<tr>",o+="<td>"+t+"</td>",o+="<td>"+e.time+"</td>",o+="<td>"+e.medicationName+"</td>",o+="<td>"+e.dosage.split(" ")[0]+"</td>",o+="<td>"+e.dosage.split(" ")[1]+"</td>",o+="</tr>"}),o+="</table>",i("#getMedicationsTable").html(o)},error:function(t,e,o){console.log("Error: "+t.responseText)}})}),i("#pastObservations").click(function(){var t=localStorage.getItem("user");i.ajax({type:"GET",url:"http://localhost:8080/observation/"+t,success:function(t){var o='<table class="table">';o+="<th>No</th>",o+="<th>Time Recorded</th>",o+="<th>Diabetic Value</th>",i(t).each(function(t,e){o+="<tr>",o+="<td>"+t+"</td>",o+="<td>"+e.time+"</td>",o+="<td>"+e.diabeticRecord+" mg/dL</td>",o+="</tr>"}),o+="</table>",i("#pastObservationsTable").html(o)},error:function(t,e,o){console.log("Error: "+t.responseText)}})}),i("#pastMeals").click(function(){var t=localStorage.getItem("user");i.ajax({type:"GET",url:"http://localhost:8080/nutritionOrder/"+t,success:function(t){var o='<table class="table">';o+="<th>No</th>",o+="<th>Time Recorded</th>",o+="<th>Food Name</th>",o+="<th>Meal Size</th>",o+="<th>Calories</th>",i(t).each(function(t,e){o+="<tr>",o+="<td>"+t+"</td>",o+="<td>"+e.time+"</td>",o+="<td>"+e.foodName+"</td>",o+="<td>"+e.mealSize+"</td>",o+="<td>"+e.calories+"</td>",o+="</tr>"}),o+="</table>",i("#pastMealsTable").html(o)},error:function(t,e,o){console.log("Error: "+t.responseText)}})}),i("#searchFoodButton").click(function(){var t=i("#mealName").val(),e=null;i.ajax({type:"GET",url:"http://localhost:8080/food/find?foodName="+t,success:function(t){e=t.branded,i("#searchFood").modal("toggle");var o='<table class="table">';o+="<th>No</th>",o+="<th>Food name</th>",o+="<th>Calories</th>",o+="<th>Serving quantity</th>",o+="<th>Select</th>",i(e).each(function(t,e){o+="<tr>",o+="<td>"+t+"</td>",o+="<td>"+e.food_name+"</td>",o+="<td>"+e.nf_calories+"</td>",o+="<td>"+e.serving_qty+"</td>",o+="<td><button id='selectFoodButton'  type='button' class='btn btn-primary'>Select</button></td>",o+="</tr>"}),o+="</table>",i("#searchFoodTable").html(o)},error:function(t,e,o){console.log("Error: "+t.responseText)}})}),i("#searchMedicineButton").click(function(){var t=i("#medicineName").val(),e=null;i.ajax({type:"GET",url:"http://localhost:8080/medication/find?medicationName="+t,success:function(t){e=t,i("#searchMedicine").modal("toggle");var a='<table class="table">';a+="<th>No</th>",a+="<th>Medicine name</th>",a+="<th>Type</th>",a+="<th>Select</th>",i(e).each(function(t,e){var o=unescape(e).split(",");a+="<tr>",a+="<td>"+t+"</td>",a+="<td>"+o[2].replaceAll('"',"")+"</td>",a+="<td>"+o[3].replaceAll('"',"")+"</td>",a+="<td><button id='selectMedicineButton'  type='button' class='btn btn-primary'>Select</button></td>",a+="</tr>"}),a+="</table>",i("#searchMedicineTable").html(a)},error:function(t,e,o){console.log("Error: "+t.responseText)}})}),i("#searchFood #searchFoodTable").on("click","#selectFoodButton",function(){var t=i(this).closest("tr").find("td"),e="";i.each(t,function(){console.log(i(this).text()),e+=i(this).text()+":"}),i("#searchFood").modal("hide"),i("#foodInfo").val(e),i("#mealName").val(e.split(":")[1])}),i("#closeSearch").click(function(){i("#searchFood").modal("hide")}),i("#logoutProcess").click(function(){localStorage.removeItem("user"),window.location="login.html"}),i("#searchMedicine #searchMedicineTable").on("click","#selectMedicineButton",function(){var t=i(this).closest("tr").find("td"),e="";i.each(t,function(){e+=i(this).text()+":"}),i("#searchMedicine").modal("hide"),i("#medicalInfo").val(e);for(var o=e.split(":"),a=o[1].split(" "),n=null,r=0;r<a.length;r++)(a[r].includes("MG")||a[r].includes("MG\\ML")||a[r].includes("ML"))&&(n=a[r]);if(null!==n)i("#medicineName").val(o[1].replaceAll(n,"")),i("#medicationUnit").val(n);else{i("#medicineName").val(o[1]);var l=i("#medicationUnit").val();console.log(l),i("#medicationUnit").val("")}}),i("#closeMedicationSearch").click(function(){i("#searchMedicine").modal("hide")})}(jQuery);